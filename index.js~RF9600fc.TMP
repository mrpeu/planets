
(function(){
  //---------
  // Map
  //

  var map = [{
  	name: "0",
  	home: { r: 30, mat: { color: 0xFFFFFF} },
  	planets: [
  		{ x: -150, y: 150, r: 20, mat: { color: 0x22DD55 } },		
  		{ x: 200, y: 20, r: 14, mat: { color: 0x2255DD } }
  	]
  }];


  //---------
  // Planet
  //

  function Planet( param ) {
  	this.init( param );
  }

  Planet.prototype = {

  	init: function( param ){

  		this.free = param.free || false;
  		this.radius = param.r || 10;

  		// speed
  		this.sx = param.sx || random( -0.5, 0.5 ) ;
  		this.sy = param.sy || random( -0.5, 0.5 );
  		// acceleration
  		this.ax = param.ax || 0.0;
  		this.ay = param.ay || 0.0;
  		// rotation speed
  		this.rx = param.rx || 0.002;
  		this.ry = param.ry || 0.005;

  		if(typeof(param.mat)!==undefined)
  			this.material = new THREE.MeshLambertMaterial( param.mat );
  		else
  			this.material = new THREE.MeshLambertMaterial( { color: 0xFFFFFF, wireframe: true } ) ;

          this.geometry = new THREE.SphereGeometry( this.radius );
          this.mesh = new THREE.Mesh( this.geometry, this.material );

  		this.mesh.position.x = param.x || 0;
  		this.mesh.position.y = param.y || 0;

  	},

  	move: function( ctx ){

  		if(this.free){

  			this.mesh.position.x += this.sx;
  			this.mesh.position.y += this.sy;

  			this.sx += this.ax;
  			this.sy += this.ay;
  		}

      this.mesh.rotation.x += this.rx;
  		this.mesh.rotation.y += this.ry;

  	}

  };


  //----------
  // Init and go!
  //

  var camera, 
      scene,
      sketch, 
      renderer = new THREE.WebGLRenderer(),
      stars = [],
      currentMap = map[0]
  ;

  try{
    
      var
        container = document.getElementById("container")
      ;
      
      function Init() {


        renderer.setSize( container.width, container.height );

        container.AppenChild( renderer.domElement );

        scene = new THREE.Scene();

        camera = new THREE.OrthographicCamera( 
          this.width / - 2, this.width / 2, this.height / 2, this.height / - 2, 1, 800 
        );
        camera.position.set( 0, 0, 500);
        camera.lookAt( scene.position );


        var p; // tmp

        // create home
        stars.push( p = new Planet( currentMap.home ));
        scene.add( p.mesh );

        // create satellites
        for (var i = map[0].planets.length - 1; i >= 0; i--) {

        	stars.push( p = new Planet( currentMap.planets[i] ) );
        	scene.add( p.mesh );

        };


        var directionalLight = new THREE.DirectionalLight( 0xffffff, 0.9 );
        directionalLight.position.set( 0, 0, 1 );

        scene.add( directionalLight );
        

        renderer.render( scene, camera );

      };
      
      function Resize() {

        camera.left = window.innerWidth / - 2;
        camera.right = window.innerWidth / 2;
        camera.top = window.innerHeight / 2;
        camera.bottom = window.innerHeight / - 2;

        camera.updateProjectionMatrix();
        
        renderer.setSize( this.width, this.height );
      };
    
      function update() {

        for (var i = stars.length - 1; i >= 0; i--) {
        	stars[i].move(this);
        }
      
      };
    
      function draw( ctx ) {
      
        renderer.render( scene, camera );

      };


      Init();

    
  } catch (error) {
    nogl = document.getElementById("nogl");
    nogl.style.display = 'block';
  }

})();

// next step: http://stemkoski.github.io/Three.js/Mouse-Over.html